import sounddevice as sd
from scipy.io.wavfile import write, read
import time

# --- FUNCIÃ“N PARA TRANSMITIR (HABLAR) ---
def transmitir_audio(archivo_wav):
    print(f"ðŸ“» Transmitiendo: {archivo_wav}...")
    fs, data = read(archivo_wav)
    sd.play(data, fs)
    sd.wait()  # Espera a que termine de sonar
    print("âœ… TransmisiÃ³n terminada.")

# --- FUNCIÃ“N PARA ESCUCHAR (GRABAR) ---
def escuchar_y_guardar(segundos=120):
    fs = 44100  # Frecuencia de muestreo estÃ¡ndar
    print(f"ðŸ‘‚ Escuchando frecuencia por {segundos} segundos...")
    grabacion = sd.rec(int(segundos * fs), samplerate=fs, channels=1)
    sd.wait()  # Espera a que termine la grabaciÃ³n
    write('seÃ±al_recibida.wav', fs, grabacion)
    print("âœ… SeÃ±al guardada como 'seÃ±al_recibida.wav'. Â¡Lista para decodificar!")

# --- MENÃš SIMPLE ---
while True:
    print("\n--- SSTV STATION 1.0 ---")
    print("1. Transmitir imagen (convertida a sonido)")
    print("2. Escuchar y capturar seÃ±al del aire")
    print("3. Salir")
    opcion = input("Selecciona una opciÃ³n: ")

    if opcion == "1":
        archivo = input("Nombre del archivo .wav a transmitir: ")
        transmitir_audio(archivo)
    elif opcion == "2":
        escuchar_y_guardar()
    elif opcion == "3":
        break
