<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radio Cartoon Studio V5</title>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Press+Start+2P&family=Permanent+Marker&family=Luckiest+Guy&family=Chakra+Petch:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* Estilos para la Cinem√°tica de Inicio */
        #intro-screen {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background: linear-gradient(to bottom, #87CEEB, #ffffff); /* Cielo azul claro */
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            overflow: hidden;
            z-index: 9999;
        }
        #sun {
            position: absolute;
            bottom: -50px;
            width: 200px; height: 200px;
            background-color: #FFD700; /* Dorado */
            border-radius: 50%;
            box-shadow: 0 0 50px #FFD700;
            animation: rise 3s ease-out forwards;
        }
        #intro-logo {
            font-family: 'Bangers', cursive;
            font-size: 80px;
            color: white;
            text-shadow: 8px 8px 0px #000;
            opacity: 0;
            animation: fadeInLogo 2s ease-in 2.5s forwards;
            position: relative; /* Para que aparezca sobre el sol */
            z-index: 10;
        }
        #intro-slogan {
            font-family: 'Press Start 2P', cursive;
            font-size: 20px;
            color: #000;
            opacity: 0;
            animation: fadeInLogo 2s ease-in 3.5s forwards;
            margin-top: 15px;
            position: relative;
            z-index: 10;
        }
        @keyframes rise {
            from { bottom: -50px; }
            to { bottom: calc(50% - 100px); } /* Sube a la mitad de la pantalla */
        }
        @keyframes fadeInLogo {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOutIntro {
            from { opacity: 1; }
            to { opacity: 0; visibility: hidden; }
        }
        .hide-intro { animation: fadeOutIntro 1s ease-out 0s forwards; }

        /* Estilos del Editor (igual que antes, pero con nuevas fuentes) */
        :root {
            --primary: #00f2ff;
            --yellow: #ffde00;
            --comic-border: 4px solid #000;
            --comic-shadow: 5px 5px 0px #000;
        }

        body {
            font-family: sans-serif; /* Base para el editor */
            background: #1a1a1a;
            color: white;
            margin: 0;
            display: flex;
            flex-direction: column; 
            min-height: 100vh;
        }

        @media (min-width: 768px) {
            body { flex-direction: row; }
        }

        .sidebar {
            width: 100%;
            background: #222;
            padding: 20px;
            border-bottom: 3px solid #000;
            box-sizing: border-box;
            overflow-y: auto;
        }

        @media (min-width: 768px) {
            .sidebar { width: 350px; height: 100vh; border-bottom: none; border-right: 3px solid #000; }
        }

        .tool-box { background: #333; padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 2px solid #444; }
        h3 { margin: 0 0 10px 0; font-size: 14px; color: var(--primary); text-transform: uppercase; }

        .canvas-area {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            overflow: hidden;
        }

        #poster {
            width: 90vw; 
            height: 126vw; 
            max-width: 450px; 
            max-height: 630px;
            background: linear-gradient(135deg, #7000ff, #ff0080);
            border: 5px solid #000;
            position: relative;
            overflow: hidden;
            background-size: cover;
            background-position: center;
        }

        .draggable {
            position: absolute;
            cursor: grab; /* Cambiado a grab */
            text-align: center;
            line-height: 1.1;
            user-select: none;
            word-wrap: break-word;
            max-width: 90%;
            color: white;
            text-shadow: 
                3px 3px 0 #000, -2px -2px 0 #000, 
                2px -2px 0 #000, -2px 2px 0 #000,
                0px 4px 0 #000;
            padding: 5px; /* Peque√±o padding para mejor selecci√≥n */
        }

        /* Fuentes espec√≠ficas para cada clase o para aplicar al seleccionar */
        .text-title { font-size: 40px; color: var(--yellow); font-family: 'Bangers', cursive; }
        .text-date { font-size: 25px; color: #ff3e3e; font-family: 'Permanent Marker', cursive; }
        .text-info { font-size: 20px; color: #00ff88; font-family: 'Chakra Petch', sans-serif; }
        .draggable img { max-width: 100%; height: auto; border: var(--comic-border); }

        .draggable.selected { outline: 3px dashed var(--primary); outline-offset: 5px; cursor: grabbing; }

        button, select {
            width: 100%; padding: 10px; margin-bottom: 8px; border: 3px solid #000;
            border-radius: 8px; font-weight: bold; cursor: pointer; transform: translateY(0);
            transition: 0.1s; box-shadow: 3px 3px 0 #000;
        }
        button:active, select:active { transform: translate(2px, 2px); box-shadow: none; }
        .btn-add { background: var(--yellow); color: #000; }
        .btn-save { background: #00ff88; font-size: 18px; margin-top: 10px; }

        textarea, input[type="color"] {
            width: 100%; padding: 8px; border-radius: 5px; border: 2px solid #000; margin-bottom: 10px;
            box-sizing: border-box; /* Para que el padding no afecte el width */
        }
    </style>
</head>
<body>

    <div id="intro-screen">
        <div id="sun"></div>
        <div id="intro-logo">RADIO COOL</div>
        <div id="intro-slogan">Editor de poster, Por CL7ADV.</div>
    </div>

    <div class="sidebar">
        <h2 style="text-align: center; color: var(--yellow);">RADIO EDIT PRO V5</h2>
        
        <div class="tool-box">
            <h3>üñºÔ∏è Fondo y Logos</h3>
            <label style="font-size: 12px;">Fondo del P√≥ster:</label>
            <input type="file" id="bg-file" accept="image/*">
            <button class="btn-add" onclick="addImage()">+ Subir Foto/Logo</button>
        </div>

        <div class="tool-box">
            <h3>‚úçÔ∏è A√±adir Textos</h3>
            <button class="btn-add" onclick="addText('text-title', 'T√çTULO SHOW')">T√çTULO</button>
            <button class="btn-add" onclick="addText('text-date', 'üìÖ S√ÅBADO 20:00')">FECHA/HORA</button>
            <button class="btn-add" onclick="addText('text-info', 'üìç 99.9 FM | @RADIO')">DATOS / DIAL</button>
        </div>

        <div id="editor-panel" class="tool-box" style="display:none;">
            <h3>üõ†Ô∏è Editar Seleccionado</h3>
            <label style="font-size: 12px;">Contenido:</label>
            <textarea id="edit-content"></textarea>
            
            <label style="font-size: 12px;">Color de Texto:</label>
            <input type="color" id="edit-color">

            <label style="font-size: 12px;">Fuente:</label>
            <select id="edit-font">
                <option value="Bangers, cursive">Bangers (C√≥mic)</option>
                <option value="Permanent Marker, cursive">Permanent Marker (Marcador)</option>
                <option value="Luckiest Guy, cursive">Luckiest Guy (Cartel)</option>
                <option value="Chakra Petch, sans-serif">Chakra Petch (Futurista)</option>
                <option value="Arial Black, sans-serif">Arial Black (Por defecto)</option>
            </select>

            <label style="font-size: 12px;">Tama√±o (px):</label>
            <input type="number" id="edit-size" min="10" max="100" value="20">

            <div style="display:flex; gap:10px; margin-top:10px;">
                <button onclick="changeZ(1)">Frente</button>
                <button onclick="changeZ(-1)">Atr√°s</button>
            </div>
            <button style="background:#ff4444; color:white;" onclick="deleteEl()">Eliminar</button>
        </div>

        <button class="btn-save" onclick="download()">DESCARGAR P√ìSTER</button>
    </div>

    <div class="canvas-area">
        <div id="poster">
            <div class="draggable text-title" style="top:40px; left:20px; z-index: 5;">PROGRAMA RADIO</div>
        </div>
    </div>

    <script>
        let selectedEl = null;

        // Funci√≥n de selecci√≥n
        function select(el) {
            if(selectedEl) selectedEl.classList.remove('selected');
            selectedEl = el;
            selectedEl.classList.add('selected');
            document.getElementById('editor-panel').style.display = 'block';

            // Cargar valores al panel de edici√≥n
            document.getElementById('edit-content').value = el.innerText || "";
            document.getElementById('edit-color').value = rgbToHex(el.style.color || window.getComputedStyle(el).color);
            document.getElementById('edit-font').value = el.style.fontFamily || window.getComputedStyle(el).fontFamily;
            document.getElementById('edit-size').value = parseInt(el.style.fontSize) || parseInt(window.getComputedStyle(el).fontSize);
        }

        // Conversor de RGB a Hex (para el color picker)
        function rgbToHex(rgb) {
            if (!rgb || rgb.startsWith('#')) return rgb; // Ya es hex o vac√≠o
            const parts = rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);
            if (!parts) return rgb; // No es RGB v√°lido
            delete(parts[0]);
            for (let i = 1; i <= 3; ++i) {
                parts[i] = parseInt(parts[i]).toString(16);
                if (parts[i].length === 1) parts[i] = '0' + parts[i];
            }
            return '#' + parts.join('');
        }

        // Funci√≥n de arrastre (compatible con Mouse y Touch)
        function makeDraggable(el) {
            let p1 = 0, p2 = 0, p3 = 0, p4 = 0;
            const dragStart = (e) => {
                select(el);
                e.preventDefault(); // Evita scroll en m√≥vil al arrastrar
                const clientX = e.clientX || e.touches[0].clientX;
                const clientY = e.clientY || e.touches[0].clientY;
                p3 = clientX; p4 = clientY;

                document.onmouseup = document.ontouchend = () => {
                    document.onmouseup = document.onmousemove = document.ontouchend = document.ontouchmove = null;
                };
                document.onmousemove = document.ontouchmove = (e) => {
                    const cx = e.clientX || e.touches[0].clientX;
                    const cy = e.clientY || e.touches[0].clientY;
                    p1 = p3 - cx; p2 = p4 - cy;
                    p3 = cx; p4 = cy;
                    el.style.top = (el.offsetTop - p2) + "px";
                    el.style.left = (el.offsetLeft - p1) + "px";
                };
            };
            el.onmousedown = el.ontouchstart = dragStart;
        }

        // --- FUNCIONES DE ADICI√ìN ---
        function addText(type, val) {
            const div = document.createElement('div');
            div.className = `draggable ${type}`;
            div.innerText = val;
            div.style.left = '50px'; div.style.top = '150px';
            div.style.zIndex = 10;
            document.getElementById('poster').appendChild(div);
            makeDraggable(div);
            select(div);
        }

        function addImage() {
            const input = document.createElement('input');
            input.type = 'file';
            input.onchange = e => {
                const reader = new FileReader();
                reader.onload = () => {
                    const img = document.createElement('img');
                    img.src = reader.result;
                    img.className = 'draggable';
                    img.style.width = '150px';
                    img.style.border = '4px solid black';
                    img.style.zIndex = 10;
                    document.getElementById('poster').appendChild(img);
                    makeDraggable(img);
                    select(img);
                };
                reader.readAsDataURL(e.target.files[0]);
            };
            input.click();
        }

        // --- EVENTOS DEL PANEL DE EDICI√ìN ---
        document.getElementById('edit-content').addEventListener('input', e => {
            if(selectedEl && selectedEl.tagName !== 'IMG') selectedEl.innerText = e.target.value;
        });

        document.getElementById('edit-color').oninput = e => {
            if(selectedEl && selectedEl.tagName !== 'IMG') selectedEl.style.color = e.target.value;
            else if (selectedEl && selectedEl.tagName === 'IMG') selectedEl.style.borderColor = e.target.value; // Para cambiar color de borde de imagen
        };

        document.getElementById('edit-font').onchange = e => {
            if(selectedEl && selectedEl.tagName !== 'IMG') selectedEl.style.fontFamily = e.target.value;
        };

        document.getElementById('edit-size').oninput = e => {
            if(selectedEl && selectedEl.tagName !== 'IMG') selectedEl.style.fontSize = e.target.value + 'px';
            else if (selectedEl && selectedEl.tagName === 'IMG') {
                selectedEl.style.width = e.target.value * 3 + 'px'; // Ajuste el tama√±o de la imagen de forma relativa
            }
        };

        function changeZ(v) {
            if(selectedEl) {
                let z = parseInt(selectedEl.style.zIndex) || 1;
                selectedEl.style.zIndex = z + v;
            }
        }

        function deleteEl() { if(selectedEl) { selectedEl.remove(); selectedEl = null; document.getElementById('editor-panel').style.display = 'none'; } }

        document.getElementById('bg-file').onchange = e => {
            const reader = new FileReader();
            reader.onload = () => document.getElementById('poster').style.backgroundImage = `url(${reader.result})`;
            reader.readAsDataURL(e.target.files[0]);
        };

        function download() {
            if(selectedEl) selectedEl.classList.remove('selected');
            html2canvas(document.getElementById('poster'), { scale: 2, useCORS: true }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'radio-cartoon.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        // --- CINETMATICA DE INICIO ---
        window.onload = () => {
            setTimeout(() => {
                document.getElementById('intro-screen').classList.add('hide-intro');
                document.body.style.overflow = 'auto'; // Permitir scroll despu√©s de la intro
            }, 4500); // Duraci√≥n total de la animaci√≥n de intro
             makeDraggable(document.querySelector('.draggable')); // Inicializar el elemento de texto inicial
        };
    </script>
</body>
</html>
