<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radio Amateur Toolbox - Cuba</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
        }

        .mono { font-family: 'JetBrains+Mono', monospace; }
        
        .card {
            background: #1e293b;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border: 1px solid #334155;
        }

        .input-field {
            background: #0f172a;
            border: 1px solid #475569;
            color: #f8fafc;
            padding: 0.5rem;
            border-radius: 6px;
            width: 100%;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: bold;
            transition: all 0.2s;
        }

        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #475569;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .tab-btn {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }

        .tab-btn.active {
            border-bottom: 2px solid #3b82f6;
            color: #3b82f6;
        }

        .status-badge {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .sync-qrz {
            background: #f97316;
            color: white;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-5xl mx-auto">
        <!-- Header -->
        <header class="mb-8 text-center md:text-left flex flex-col md:flex-row justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-blue-400">Radio Amateur Toolbox</h1>
                <p class="text-slate-400">Herramientas esenciales para el operador Cubano</p>
            </div>
            <div id="clock-container" class="flex flex-col items-end">
                <div id="clock" class="text-2xl font-bold mono bg-slate-800 p-2 rounded border border-slate-700">
                    00:00:00 UTC
                </div>
                <span class="text-xs text-slate-500 mt-1">Hora universal coordinada</span>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="flex border-b border-slate-700 mb-6 overflow-x-auto whitespace-nowrap">
            <div class="tab-btn active" onclick="showTab('calc')">Antenas</div>
            <div class="tab-btn" onclick="showTab('log')">Libro de Guardia</div>
            <div class="tab-btn" onclick="showTab('refs')">Referencia</div>
            <div class="tab-btn" onclick="showTab('prop')">Propagaci√≥n</div>
        </nav>

        <!-- Tab Content: Antenna Calculator -->
        <div id="tab-calc" class="tab-content">
            <div class="grid md:grid-cols-2 gap-6">
                <div class="card">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <span class="mr-2">üì°</span> Calculadora de Dipolo (1/2 Œª)
                    </h2>
                    <label class="block mb-2 text-sm text-slate-400">Frecuencia (MHz)</label>
                    <input type="number" id="freq-input" class="input-field mb-4" placeholder="Ej: 7.100" step="0.001">
                    <button onclick="calculateAntenna()" class="btn-primary w-full">Calcular Longitudes</button>
                    
                    <div id="antenna-results" class="mt-6 hidden">
                        <div class="p-4 bg-slate-900 rounded border border-blue-500/30">
                            <p class="text-sm text-slate-400">Longitud total:</p>
                            <p class="text-2xl font-bold text-blue-400" id="total-len">0.00 m</p>
                            <p class="text-sm text-slate-400 mt-2">Cada brazo (1/4 Œª):</p>
                            <p class="text-xl font-bold text-green-400" id="arm-len">0.00 m</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2 class="text-xl font-bold mb-4">Tips de Ajuste</h2>
                    <ul class="text-sm text-slate-300 space-y-2">
                        <li>‚Ä¢ Para dipolos, usa el factor 142.5 / Freq(MHz).</li>
                        <li>‚Ä¢ Deja siempre un margen extra para el nudo.</li>
                        <li>‚Ä¢ Si la ROE es alta en frecuencia baja, la antena est√° larga.</li>
                        <li>‚Ä¢ Si la ROE es alta en frecuencia alta, la antena est√° corta.</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Tab Content: Logbook -->
        <div id="tab-log" class="tab-content hidden">
            <!-- Sync Config (QRZ) -->
            <div class="card mb-6 border-orange-500/30">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-bold flex items-center">
                        <span class="mr-2">‚òÅÔ∏è</span> Sincronizaci√≥n QRZ.com
                    </h2>
                    <div id="qrz-status" class="text-xs text-slate-500 italic">No configurado</div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <input type="password" id="qrz-key" class="input-field" placeholder="Tu QRZ API Key">
                    <button onclick="syncToQRZ()" class="btn-primary bg-orange-600 hover:bg-orange-700">Subir Pendientes</button>
                    <button onclick="exportADIF()" class="btn-secondary">Exportar ADIF (.adi)</button>
                </div>
            </div>

            <!-- New Entry -->
            <div class="card mb-6">
                <h2 class="text-xl font-bold mb-4">Registrar Contacto (QSO)</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div>
                        <label class="text-xs text-slate-400">Indicativo</label>
                        <input type="text" id="log-call" class="input-field" placeholder="CO/CM/...">
                    </div>
                    <div>
                        <label class="text-xs text-slate-400">Fecha/Hora UTC (Manual)</label>
                        <input type="datetime-local" id="log-time" class="input-field text-xs">
                    </div>
                    <div>
                        <label class="text-xs text-slate-400">RST (S/R)</label>
                        <input type="text" id="log-rst" class="input-field" placeholder="59 / 599">
                    </div>
                    <div>
                        <label class="text-xs text-slate-400">Banda</label>
                        <select id="log-band" class="input-field">
                            <option value="40m">40m</option>
                            <option value="80m">80m</option>
                            <option value="20m">20m</option>
                            <option value="15m">15m</option>
                            <option value="10m">10m</option>
                            <option value="2m">2m</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs text-slate-400">Modo</label>
                        <select id="log-mode" class="input-field">
                            <option value="SSB">SSB</option>
                            <option value="CW">CW</option>
                            <option value="FT8">FT8</option>
                            <option value="FM">FM</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs text-slate-400">Nombre Op.</label>
                        <input type="text" id="log-name" class="input-field" placeholder="Opcional">
                    </div>
                    <div>
                        <label class="text-xs text-slate-400">Locator (Gridsquare)</label>
                        <input type="text" id="log-grid" class="input-field" placeholder="Ej: EL93">
                    </div>
                    <div class="flex items-end">
                        <button onclick="addLogEntry()" class="btn-primary w-full py-2">Guardar QSO</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2 class="text-xl font-bold mb-4">Historial Local</h2>
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-sm">
                        <thead class="text-slate-400 border-b border-slate-700">
                            <tr>
                                <th class="py-2">Fecha/Hora (UTC)</th>
                                <th>Callsign</th>
                                <th>RST</th>
                                <th>Banda</th>
                                <th>Modo</th>
                                <th>Grid</th>
                                <th>Sinc.</th>
                            </tr>
                        </thead>
                        <tbody id="log-table-body">
                            <!-- JS populated -->
                        </tbody>
                    </table>
                </div>
                <div class="mt-4 flex justify-between">
                    <button onclick="clearLogs()" class="text-xs text-red-400 hover:underline">Borrar base de datos local</button>
                    <span id="log-count" class="text-xs text-slate-500">0 contactos</span>
                </div>
            </div>
        </div>

        <!-- Tab Content: Reference -->
        <div id="tab-refs" class="tab-content hidden">
            <div class="grid md:grid-cols-2 gap-6">
                <div class="card">
                    <h2 class="text-xl font-bold mb-4">C√≥digo Q Com√∫n</h2>
                    <div class="space-y-1 text-sm">
                        <div class="flex justify-between border-b border-slate-700 py-1"><span>QRM</span><span class="text-slate-400">Interferencia</span></div>
                        <div class="flex justify-between border-b border-slate-700 py-1"><span>QRN</span><span class="text-slate-400">Est√°tica / Ruido</span></div>
                        <div class="flex justify-between border-b border-slate-700 py-1"><span>QRP</span><span class="text-slate-400">Baja potencia</span></div>
                        <div class="flex justify-between border-b border-slate-700 py-1"><span>QRT</span><span class="text-slate-400">Fin de transmisi√≥n</span></div>
                        <div class="flex justify-between border-b border-slate-700 py-1"><span>QRZ</span><span class="text-slate-400">¬øQui√©n me llama?</span></div>
                        <div class="flex justify-between border-b border-slate-700 py-1"><span>QSL</span><span class="text-slate-400">Confirmaci√≥n</span></div>
                        <div class="flex justify-between border-b border-slate-700 py-1"><span>QSO</span><span class="text-slate-400">Comunicado</span></div>
                        <div class="flex justify-between border-b border-slate-700 py-1"><span>QTH</span><span class="text-slate-400">Ubicaci√≥n</span></div>
                    </div>
                </div>
                <div class="card">
                    <h2 class="text-xl font-bold mb-4">Alfabeto Fon√©tico</h2>
                    <div class="grid grid-cols-2 text-xs gap-1">
                        <div>A: Alpha</div><div>B: Bravo</div><div>C: Charlie</div><div>D: Delta</div>
                        <div>E: Echo</div><div>F: Foxtrot</div><div>G: Golf</div><div>H: Hotel</div>
                        <div>I: India</div><div>J: Juliet</div><div>K: Kilo</div><div>L: Lima</div>
                        <div>M: Mike</div><div>N: November</div><div>O: Oscar</div><div>P: Papa</div>
                        <div>Q: Quebec</div><div>R: Romeo</div><div>S: Sierra</div><div>T: Tango</div>
                        <div>U: Uniform</div><div>V: Victor</div><div>W: Whiskey</div><div>X: X-ray</div>
                        <div>Y: Yankee</div><div>Z: Zulu</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content: Propagation -->
        <div id="tab-prop" class="tab-content hidden">
            <div class="card text-center p-10">
                <h2 class="text-2xl font-bold mb-4 text-blue-400">Estado de Bandas</h2>
                <div class="flex justify-center mb-6">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 w-full">
                        <div class="p-4 bg-slate-900 rounded border border-green-500/50">
                            <p class="text-xs text-slate-400">80m - 40m</p>
                            <p class="text-xl font-bold text-green-400">EXC</p>
                        </div>
                        <div class="p-4 bg-slate-900 rounded border border-green-500/50">
                            <p class="text-xs text-slate-400">20m - 15m</p>
                            <p class="text-xl font-bold text-green-400">GOOD</p>
                        </div>
                        <div class="p-4 bg-slate-900 rounded border border-yellow-500/50">
                            <p class="text-xs text-slate-400">10m</p>
                            <p class="text-xl font-bold text-yellow-400">FAIR</p>
                        </div>
                        <div class="p-4 bg-slate-900 rounded border border-red-500/50">
                            <p class="text-xs text-slate-400">VHF</p>
                            <p class="text-xl font-bold text-red-400">POOR</p>
                        </div>
                    </div>
                </div>
                <p class="text-sm text-slate-400 italic">Nota: Datos simulados basados en horario UTC. Requiere conexi√≥n para actualizaci√≥n en tiempo real.</p>
                <button class="btn-primary mt-6" onclick="window.location.reload()">Refrescar Datos</button>
            </div>
        </div>

        <!-- Footer -->
        <footer class="mt-12 text-center text-slate-500 text-sm">
            <p>73's de Radio Amateur Toolbox | Creado para el radioaficionado de coraz√≥n</p>
        </footer>
    </div>

    <script>
        // Actualizar Reloj UTC y Sugerir Hora en el Log
        function updateTime() {
            const now = new Date();
            const utc = now.toISOString().split('T')[1].split('.')[0];
            document.getElementById('clock').innerText = utc + ' UTC';
            
            // Si el campo de tiempo est√° vac√≠o, sugerir la hora actual
            const logTimeInput = document.getElementById('log-time');
            if(!logTimeInput.value) {
                // Formato para input datetime-local: YYYY-MM-DDThh:mm
                const year = now.getUTCFullYear();
                const month = String(now.getUTCMonth() + 1).padStart(2, '0');
                const day = String(now.getUTCDate()).padStart(2, '0');
                const hours = String(now.getUTCHours()).padStart(2, '0');
                const mins = String(now.getUTCMinutes()).padStart(2, '0');
                logTimeInput.value = `${year}-${month}-${day}T${hours}:${mins}`;
            }
        }
        setInterval(updateTime, 1000);
        updateTime();

        // Navegaci√≥n de Pesta√±as
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById('tab-' + tabId).classList.remove('hidden');
            event.currentTarget.classList.add('active');
        }

        // Calculadora de Antenas
        function calculateAntenna() {
            const freq = document.getElementById('freq-input').value;
            if (!freq || freq <= 0) return;

            const total = 142.5 / freq;
            const arm = total / 2;

            document.getElementById('total-len').innerText = total.toFixed(2) + ' m';
            document.getElementById('arm-len').innerText = arm.toFixed(2) + ' m';
            document.getElementById('antenna-results').classList.remove('hidden');
        }

        // Gesti√≥n del Logbook (LocalStorage)
        let logs = JSON.parse(localStorage.getItem('radio_logs')) || [];

        function renderLogs() {
            const body = document.getElementById('log-table-body');
            body.innerHTML = '';
            
            logs.slice().reverse().forEach(log => {
                const tr = document.createElement('tr');
                tr.className = "border-b border-slate-800 hover:bg-slate-800/50 transition";
                tr.innerHTML = `
                    <td class="py-3 text-slate-400 font-mono text-xs">${log.date.replace('T', ' ')}</td>
                    <td class="font-bold text-blue-300">${log.call}</td>
                    <td>${log.rst}</td>
                    <td>${log.band}</td>
                    <td><span class="status-badge bg-slate-700">${log.mode}</span></td>
                    <td class="text-slate-400 text-xs uppercase">${log.grid || '-'}</td>
                    <td>${log.synced ? '‚úÖ' : '‚è≥'}</td>
                `;
                body.appendChild(tr);
            });
            document.getElementById('log-count').innerText = `${logs.length} contactos`;
        }

        function addLogEntry() {
            const call = document.getElementById('log-call').value.toUpperCase();
            const time = document.getElementById('log-time').value;
            const rst = document.getElementById('log-rst').value || '59';
            const band = document.getElementById('log-band').value;
            const mode = document.getElementById('log-mode').value;
            const name = document.getElementById('log-name').value;
            const grid = document.getElementById('log-grid').value.toUpperCase();

            if (!call) {
                alert("El indicativo es obligatorio");
                return;
            }

            const entry = {
                date: time,
                call,
                rst,
                band,
                mode,
                name,
                grid,
                synced: false
            };

            logs.push(entry);
            localStorage.setItem('radio_logs', JSON.stringify(logs));
            renderLogs();
            
            // Limpiar campos principales
            document.getElementById('log-call').value = '';
            document.getElementById('log-name').value = '';
            document.getElementById('log-grid').value = '';
            // Resetear hora al instante actual
            document.getElementById('log-time').value = ''; 
            updateTime();
        }

        // Simulaci√≥n de Sincronizaci√≥n QRZ
        function syncToQRZ() {
            const apiKey = document.getElementById('qrz-key').value;
            if(!apiKey) {
                alert("Por favor ingresa tu API Key de QRZ Logbook para sincronizar.");
                return;
            }

            const unsynced = logs.filter(l => !l.synced);
            if(unsynced.length === 0) {
                alert("No hay contactos nuevos para subir.");
                return;
            }

            // Simulaci√≥n de proceso API
            document.getElementById('qrz-status').innerText = "Sincronizando...";
            
            setTimeout(() => {
                logs.forEach(l => l.synced = true);
                localStorage.setItem('radio_logs', JSON.stringify(logs));
                renderLogs();
                document.getElementById('qrz-status').innerText = "Sincronizaci√≥n completa";
                alert(`Se han subido ${unsynced.length} contactos a QRZ.`);
            }, 2000);
        }

        // Exportaci√≥n ADIF Simple
        function exportADIF() {
            if(logs.length === 0) return alert("No hay datos para exportar.");
            
            let adif = "ADIF Export from Radio Amateur Toolbox\n<EOH>\n";
            logs.forEach(log => {
                const date = log.date.split('T')[0].replace(/-/g, '');
                const time = log.date.split('T')[1].replace(/:/g, '');
                adif += `<CALL:${log.call.length}>${log.call} <QSO_DATE:${date.length}>${date} <TIME_ON:${time.length}>${time} <BAND:${log.band.length}>${log.band} <MODE:${log.mode.length}>${log.mode} <RST_SENT:${log.rst.length}>${log.rst} <EOR>\n`;
            });

            const blob = new Blob([adif], {type: 'text/plain'});
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `logbook_${new Date().toISOString().slice(0,10)}.adi`;
            a.click();
        }

        function clearLogs() {
            if (confirm('¬øEst√°s seguro de borrar todos los contactos guardados localmente?')) {
                logs = [];
                localStorage.removeItem('radio_logs');
                renderLogs();
            }
        }

        // Carga inicial
        renderLogs();
    </script>
</body>
</html>
