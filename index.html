<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LogoGen AI - Círculo Perfecto</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
        }

        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .loader {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-left-color: #38bdf8;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .logo-preview-container {
            aspect-ratio: 1 / 1;
            background-color: #e5e7eb;
            background-image: 
                linear-gradient(45deg, #d1d5db 25%, transparent 25%), 
                linear-gradient(-45deg, #d1d5db 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, #d1d5db 75%), 
                linear-gradient(-45deg, transparent 75%, #d1d5db 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            border-radius: 50%;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            max-width: 450px;
            margin: 0 auto;
        }

        input, select, textarea {
            background: rgba(15, 23, 42, 0.6) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            color: white !important;
        }

        input:focus {
            border-color: #38bdf8 !important;
            outline: none;
        }

        .btn-generate {
            background: linear-gradient(135deg, #0ea5e9 0%, #2563eb 100%);
            transition: all 0.3s ease;
        }

        .btn-generate:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(14, 165, 233, 0.4);
        }
        
        input[type="range"] {
            accent-color: #38bdf8;
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

    <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <!-- Panel de Control -->
        <div class="lg:col-span-4 space-y-6">
            <div class="glass-panel p-6 rounded-3xl">
                <h1 class="text-2xl font-bold mb-2 flex items-center gap-2">
                    <span class="text-sky-400">LogoGen</span> AI
                </h1>
                <p class="text-slate-400 text-sm mb-6">Cierre de precisión y estilos premium.</p>

                <div class="space-y-4">
                    <div>
                        <label class="block text-xs font-semibold uppercase tracking-wider text-slate-500 mb-1">Texto Superior</label>
                        <input type="text" id="topText" class="w-full p-3 rounded-xl" value="SANTA CRUZ DEL SUR">
                    </div>

                    <div>
                        <label class="block text-xs font-semibold uppercase tracking-wider text-slate-500 mb-1">Texto Inferior</label>
                        <input type="text" id="bottomText" class="w-full p-3 rounded-xl" value="CAMAGÜEY - CUBA">
                    </div>

                    <div>
                        <label class="block text-xs font-semibold uppercase tracking-wider text-slate-500 mb-1">Sub-título Central</label>
                        <input type="text" id="midText" class="w-full p-3 rounded-xl" value="RADIO CLUB">
                    </div>

                    <div>
                        <label class="block text-xs font-semibold uppercase tracking-wider text-slate-500 mb-1">Elementos Visuales</label>
                        <textarea id="elements" rows="2" class="w-full p-3 rounded-xl text-sm">Una palmera, una radio antigua en la playa, atardecer.</textarea>
                    </div>

                    <div>
                        <label class="block text-xs font-semibold uppercase tracking-wider text-slate-500 mb-1">Cierre del Círculo (Ajuste)</label>
                        <input type="range" id="cropFactor" min="60" max="100" value="98" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                        <div class="flex justify-between text-[10px] text-slate-500 mt-1">
                            <span>Más cerrado</span>
                            <span>Borde original</span>
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs font-semibold uppercase tracking-wider text-slate-500 mb-1">Estilo Premium</label>
                        <select id="style" class="w-full p-3 rounded-xl appearance-none cursor-pointer">
                            <option value="luxury vintage metallic circular emblem, polished silver details, 3D relief">Metálico Lujoso</option>
                            <option value="elegant glass badge with metal frame, circular, highly reflective">Cristal Elegante</option>
                            <option value="modern clean circular flat vector, professional emblem">Plano Moderno</option>
                            <option value="cyberpunk neon style circular logo, glowing lines, dark background">Neón Nocturno</option>
                            <option value="embossed leather patch, circular, stitched edges, rustic brown">Cuero Grabado</option>
                            <option value="fine porcelain and gold circular emblem, white ceramic, gold leaf">Porcelana y Oro</option>
                        </select>
                    </div>

                    <button id="generateBtn" class="btn-generate w-full py-4 rounded-2xl font-bold text-lg mt-2 shadow-lg">
                        Generar Logo
                    </button>
                </div>
            </div>
        </div>

        <!-- Área de Previsualización -->
        <div class="lg:col-span-8 flex flex-col gap-4">
            <div id="previewContainer" class="logo-preview-container border-4 border-sky-500/20">
                <div id="placeholderText" class="text-center p-8">
                    <p class="text-slate-500 font-medium text-lg">Tu Logo Circular aparecerá aquí</p>
                    <p class="text-slate-600 text-sm">Sin textos extraños, solo tus palabras.</p>
                </div>

                <div id="loadingOverlay" class="hidden absolute inset-0 bg-slate-900/90 flex flex-col items-center justify-center z-10">
                    <div class="loader mb-4"></div>
                    <p class="text-white font-medium animate-pulse">Generando diseño circular perfecto...</p>
                </div>

                <img id="resultImage" class="hidden w-full h-full object-contain" alt="Logo final">
            </div>

            <div id="actionButtons" class="hidden flex flex-col gap-4">
                <div class="bg-blue-500/10 border border-blue-500/20 p-3 rounded-xl text-xs text-blue-200 text-center italic">
                    Tip: Ajusta el slider si el logo tiene sombras fuera del borde circular.
                </div>
                <button onclick="downloadCircularLogo()" class="w-full bg-white text-slate-900 hover:bg-slate-200 py-4 rounded-xl font-bold flex items-center justify-center gap-2 transition-all shadow-xl">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                    DESCARGAR PNG SIN FONDO
                </button>
            </div>
        </div>
    </div>

    <canvas id="cropCanvas" style="display:none;"></canvas>

    <script>
        const apiKey = ""; 
        const generateBtn = document.getElementById('generateBtn');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const resultImage = document.getElementById('resultImage');
        const placeholderText = document.getElementById('placeholderText');
        const actionButtons = document.getElementById('actionButtons');
        const cropCanvas = document.getElementById('cropCanvas');
        const cropFactorInput = document.getElementById('cropFactor');

        let lastRawImage = null;

        async function generateLogo() {
            const topText = document.getElementById('topText').value;
            const bottomText = document.getElementById('bottomText').value;
            const midText = document.getElementById('midText').value;
            const elements = document.getElementById('elements').value;
            const style = document.getElementById('style').value;

            // Prompt revisado para excluir palabras técnicas del contenido visual
            const prompt = `A professional circular emblem isolated on a solid white background. 
            The ONLY visible text on the logo must be exactly: "${topText}" (on top), "${bottomText}" (on bottom), and "${midText}" (in the center). 
            Do NOT include any other words or technical terms.
            Content of the logo: ${elements}. 
            Visual style: ${style}. 
            Perfectly centered, ultra-clean edges, professional design.`;

            loadingOverlay.classList.remove('hidden');
            generateBtn.disabled = true;

            try {
                const response = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        instances: [{ prompt: prompt }],
                        parameters: { sampleCount: 1 }
                    })
                });

                const data = await response.json();
                
                if (data.predictions && data.predictions[0].bytesBase64Encoded) {
                    lastRawImage = `data:image/png;base64,${data.predictions[0].bytesBase64Encoded}`;
                    applyCircularCrop();
                }
            } catch (error) {
                console.error(error);
                alert("Error de conexión. Intenta de nuevo.");
            } finally {
                loadingOverlay.classList.add('hidden');
                generateBtn.disabled = false;
            }
        }

        function applyCircularCrop() {
            if (!lastRawImage) return;

            const img = new Image();
            img.onload = function() {
                const size = Math.min(img.width, img.height);
                const factor = parseInt(cropFactorInput.value) / 100;
                
                cropCanvas.width = size;
                cropCanvas.height = size;
                const ctx = cropCanvas.getContext('2d');

                ctx.clearRect(0, 0, size, size);
                ctx.save();
                ctx.beginPath();
                ctx.arc(size / 2, size / 2, (size / 2) * factor, 0, Math.PI * 2);
                ctx.clip();
                ctx.drawImage(img, (img.width - size) / 2, (img.height - size) / 2, size, size, 0, 0, size, size);
                ctx.restore();

                const finalUrl = cropCanvas.toDataURL("image/png");
                resultImage.src = finalUrl;
                resultImage.classList.remove('hidden');
                placeholderText.classList.add('hidden');
                actionButtons.classList.remove('hidden');
            };
            img.src = lastRawImage;
        }

        cropFactorInput.addEventListener('input', applyCircularCrop);

        async function fetchWithRetry(url, options, retries = 5, backoff = 1000) {
            try {
                const res = await fetch(url, options);
                if (!res.ok && retries > 0) throw new Error(res.statusText);
                return res;
            } catch (err) {
                if (retries <= 0) throw err;
                await new Promise(resolve => setTimeout(resolve, backoff));
                return fetchWithRetry(url, options, retries - 1, backoff * 2);
            }
        }

        function downloadCircularLogo() {
            const link = document.createElement('a');
            link.href = resultImage.src;
            link.download = 'logo_circular_personalizado.png';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        generateBtn.addEventListener('click', generateLogo);
    </script>
</body>
</html>
